!function(t){function s(e){if(i[e])return i[e].exports;var n=i[e]={exports:{},id:e,loaded:!1};return t[e].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}var i={};return s.m=t,s.c=i,s.p="",s(0)}([function(t,s,i){i(1),t.exports=i(14)},function(t,s,i){"use strict";function e(){var t=Date.now(),s=t-P;P=t,I=new Array;for(var i=0;i<M.length;i++)Math.abs(v.position.x-M[i].position.x)<f.drawingdistance&&Math.abs(v.position.y-M[i].position.y)<f.drawingdistance&&(M[i].angle=h.Angle.normalizeangle(Math.atan2(M[i].position.y-v.position.y,M[i].position.x-v.position.x)),I.push(M[i]));v.getcontrols(w,y,s),x.renderframe(s,y,v,I),requestAnimationFrame(e),d.innerText=Math.floor(1e3/s).toString()}for(var n=i(2),o=i(3),a=i(4),r=i(9),h=i(10),l=i(11),c=i(12),d=document.getElementById("fps"),u=window.innerWidth<1024?window.innerWidth:1024,f={width:u,height:Math.floor(u/1.8),fov:70*Math.PI/180,drawingdistance:20,floorcolor1:"#3D2F2D",floorcolor2:"#261311"},p=document.getElementById("gamecanvas"),g=p.getContext("2d"),y=new l.Map(150,.3),w=new r.Controls,m=new o.AssetLoader,v=new c.Player({x:y.size/2+.25,y:y.size/2+.25},new h.Angle(0),f.fov,m),x=new a.Scene(g,f,m),M=new Array,k=0;k<25*y.size;k++)M.push(new n.Sprite({x:Math.random()*y.size,y:Math.random()*y.size},Math.floor(5*Math.random())));p.width=f.width,p.height=f.height,p.style.width=f.width+"px",p.style.height=f.height+"px",w.bindevents(document,p),v.initonmap(y);var I=new Array,P=Date.now();m.loadall(function(t){return document.getElementById("loading").innerHTML="Loading: "+Math.ceil(100*t)+"%"},function(){document.getElementById("loading-container").style.display="none",e()})},function(t,s){"use strict";var i=function(){function t(t,s){this.position=t,this.type=s,this.start=-1}return t}();s.Sprite=i},function(t,s){"use strict";var i=function(){function t(){this.loaded=0,this.wallssrcs=["./assets/walls/wall1.jpg","./assets/walls/wall2.jpg","./assets/walls/wall3.jpg","./assets/walls/wall4.jpg","./assets/walls/wall5.jpg","./assets/walls/wall1b.jpg","./assets/walls/wall2b.jpg","./assets/walls/wall3b.jpg","./assets/walls/wall4b.jpg","./assets/walls/wall5b.jpg","./assets/walls/wall1c.jpg","./assets/walls/wall2c.jpg","./assets/walls/wall3c.jpg","./assets/walls/wall4c.jpg","./assets/walls/wall5c.jpg"],this.walls=new Array;for(var t in this.wallssrcs)this.walls.push(new Image);this.spritessrcs=["./assets/sprites/sprite1.png","./assets/sprites/sprite2.png","./assets/sprites/sprite3.png","./assets/sprites/sprite4.png","./assets/sprites/sprite5.png"],this.sprites=new Array;for(var t in this.spritessrcs)this.sprites.push(new Image);this.skylinesrcs=["./assets/sprites/skyline.jpg"],this.skyline=new Array;for(var t in this.skylinesrcs)this.skyline.push(new Image);this.soundssrcs=["./assets/sounds/gun.mp3"],this.sounds=new Array;for(var t in this.soundssrcs)this.sounds.push(new Audio)}return t.prototype.isloaded=function(){return this.loaded==this.toload()},t.prototype.toload=function(){return this.walls.length+this.sprites.length+this.skyline.length+this.sounds.length},t.prototype.loadall=function(t,s){var i=this;for(var e in this.wallssrcs)this.walls[e].onload=function(){i.loaded+=1,t(i.loaded/i.toload()),i.isloaded()&&s()},this.walls[e].src=this.wallssrcs[e];for(var e in this.spritessrcs)this.sprites[e].onload=function(){i.loaded+=1,t(i.loaded/i.toload()),i.isloaded()&&s()},this.sprites[e].src=this.spritessrcs[e];for(var e in this.skylinesrcs)this.skyline[e].onload=function(){i.loaded+=1,t(i.loaded/i.toload()),i.isloaded()&&s()},this.skyline[e].src=this.skylinesrcs[e];for(var e in this.soundssrcs)this.sounds[e].oncanplaythrough=function(){i.loaded+=1,t(i.loaded/i.toload()),i.isloaded()&&s()},this.sounds[e].src=this.soundssrcs[e]},t}();s.AssetLoader=i},function(t,s,i){"use strict";var e=i(5),n=i(6),o=i(8),a=function(){function t(t,s,i){this.ctx=t,this.settings=s,this.assets=i,this.lastrender=Date.now(),this.height2=Math.floor(s.height/2),this.wallheight=Math.floor(.8*s.height)}return t.prototype.renderbackground=function(t){var s=this.assets.skyline[0],i=4*Math.PI,n=(e.PI2_0-(t.facing.angle+t.fov/2))/i*s.width;n=Math.abs(n),n=Math.floor(n);var o=Math.floor(s.width*t.fov/i),a=Math.floor(.5*this.settings.height);this.ctx.drawImage(s,n,0,o,s.height,0,0,this.settings.width,a),this.ctx.fillStyle=this.settings.floorcolor1,this.ctx.fillRect(0,this.height2,this.settings.width,this.settings.height)},t.prototype.renderwall=function(t,s,i,e){var n=Math.ceil(this.wallheight/s),o=Math.floor(this.height2-n/2),a=Math.floor(e*i.width),r=.7*this.settings.drawingdistance;this.ctx.drawImage(i,a,0,1,i.height,t,o,1,n),t%3==0&&(this.ctx.beginPath(),this.ctx.moveTo(t,o),this.ctx.lineTo(t,this.settings.height-o),this.ctx.lineWidth=4,this.ctx.strokeStyle="#000000",this.ctx.fillStyle="#000000",this.ctx.globalAlpha=Math.min(s,r)/r,this.ctx.stroke(),this.ctx.globalAlpha=1)},t.prototype.drawwall=function(t,s,i,e){var n=i.point.x-Math.floor(i.point.x),o=i.point.y-Math.floor(i.point.y),a=Math.abs(n>o?n:o);s<3?this.renderwall(t,s,this.assets.walls[i.type-1],a):s<8?this.renderwall(t,s,this.assets.walls[i.type-1+5],a):this.renderwall(t,s,this.assets.walls[i.type-1+10],a)},t.prototype.drawobject=function(t){var s=Math.ceil(this.wallheight/t.distance),i=Math.floor(this.height2+s/2),e=this.assets.sprites[t.type],n=Math.floor(t.starttexture*e.width),o=Math.floor(t.endtexture*e.width),a=Math.floor(.4*s),r=Math.max(1,o-n),h=i-a,l=Math.max(1,t.end-t.start);this.ctx.drawImage(e,n,0,r,e.height,t.start,h,l,a)},t.prototype.drawfloor=function(t,s,i,e){var n=Math.ceil(this.wallheight/s),o=Math.floor(this.settings.height-(this.height2-n/2));return e&&t%3==0&&(this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t,o),this.ctx.lineWidth=3,this.ctx.strokeStyle=this.settings.floorcolor2,this.ctx.stroke()),o},t.prototype.renderframe=function(t,s,i,a){this.renderbackground(i);for(var r=i.getrays(this.settings.width),h=(Math.floor(i.position.x)+Math.floor(i.position.y))%2==0,l=0;l<r.length;l++){for(var c=this.settings.height,d=h,u=void 0,f=Math.cos(i.facing.angle-r[l].angle),p=n.Ray.cast(s,i.position,null,null,r[l],this.settings.drawingdistance),g=0,y=p;g<y.length;g++){var w=y[g],m=o.DistanceCalc.getdistance(i.position,w.point)*f;w.type>0&&(u=m,this.drawwall(l,m,w,i)),c=this.drawfloor(l,m,c,d),d=!d}for(var v=0,x=a;v<x.length;v++){var M=x[v];if(M.distance=o.DistanceCalc.getdistance(i.position,M.position),M.distance<this.settings.drawingdistance&&M.distance<u){M.distance<.25&&(M.distance=.25),r[l].angle>e.PI1_5&&(r[l].angle-=e.PI2_0),M.angle>e.PI1_5&&(M.angle-=e.PI2_0);var k=(r[l].angle-M.angle)/(2*Math.atan2(.05,M.distance));Math.abs(k)<=1&&(k=Math.abs(.5*(k-1)),M.start<0&&(M.start=l,M.starttexture=k),M.end=l,M.endtexture=k)}}}for(var I=0,P=a;I<P.length;I++){var M=P[I];M.start>=0&&this.drawobject(M),M.start=-1}},t}();s.Scene=a},function(t,s){"use strict";s.PI0_5=Math.PI/2,s.PI1_0=Math.PI,s.PI1_5=3*Math.PI/2,s.PI2_0=2*Math.PI},function(t,s,i){"use strict";var e=i(7),n=function(){function t(){}return t.nearesty=function(t,s){var i=Math.floor(t.y+s.dy);i==t.y&&(i-=1);var e=i-t.y,n=s.ctg*e;return{x:n+t.x,y:i,manhattandistance:Math.abs(n)+Math.abs(e)}},t.nearestx=function(t,s){var i=Math.floor(t.x+s.dx);i==t.x&&(i-=1);var e=i-t.x,n=s.tg*e;return{x:i,y:n+t.y,manhattandistance:Math.abs(e)+Math.abs(n)}},t.cast=function(s,i,n,o,a,r){if(r<1)return[];var h=n||t.nearesty(i,a),l=o||t.nearestx(i,a);if(h.manhattandistance<l.manhattandistance){l.manhattandistance-=h.manhattandistance;var c=s.getvalue(Math.floor(h.x),h.y-(a.dy>0?0:1));return c>0?[new e.Colision(h,c)]:[new e.Colision(h,c)].concat(t.cast(s,h,null,l,a,r-h.manhattandistance))}h.manhattandistance-=l.manhattandistance;var c=s.getvalue(l.x-(a.dx>0?0:1),Math.floor(l.y));return c>0?[new e.Colision(l,c)]:[new e.Colision(l,c)].concat(t.cast(s,l,h,null,a,r-l.manhattandistance))},t}();s.Ray=n},function(t,s){"use strict";var i=function(){function t(t,s){this.point=t,this.type=s}return t}();s.Colision=i},function(t,s){"use strict";var i=function(){function t(){}return t.getdistance=function(t,s){return Math.sqrt((t.x-s.x)*(t.x-s.x)+(t.y-s.y)*(t.y-s.y))},t}();s.DistanceCalc=i},function(t,s){"use strict";var i=function(){function t(){var t=this;this.rotateleft=!1,this.rotateright=!1,this.forward=!1,this.backward=!1,this.run=!1,this.strafeleft=!1,this.straferight=!1,this.mouserotateleft=0,this.mouserotateright=0,this.shoot=!1,this.mousemovefunction=function(s){return t.mousemove(s)}}return t.prototype.mousemove=function(t){t.movementX<0?(this.mouserotateleft=-t.movementX/5,this.mouserotateright=0):t.movementX>0&&(this.mouserotateleft=0,this.mouserotateright=t.movementX/5)},t.prototype.resetmouserotate=function(){this.mouserotateleft=0,this.mouserotateright=0},t.prototype.keydown=function(t){37==t.keyCode&&(this.rotateleft=!0),68==t.keyCode&&(this.strafeleft=!0),39==t.keyCode&&(this.rotateright=!0),65==t.keyCode&&(this.straferight=!0),38!=t.keyCode&&87!=t.keyCode||(this.forward=!0),40!=t.keyCode&&83!=t.keyCode||(this.backward=!0),this.run=t.shiftKey},t.prototype.touchstart=function(t){var s=t.touches[0];this.touchend(t),s.pageX<.333*window.innerWidth?this.rotateleft=!0:s.pageX<.666*window.innerWidth?this.forward=!0:this.rotateright=!0,t.preventDefault(),t.stopPropagation()},t.prototype.touchend=function(t){this.rotateleft=!1,this.rotateright=!1,this.forward=!1,t.preventDefault(),t.stopPropagation()},t.prototype.keyup=function(t){37==t.keyCode&&(this.rotateleft=!1),68==t.keyCode&&(this.strafeleft=!1),39==t.keyCode&&(this.rotateright=!1),65==t.keyCode&&(this.straferight=!1),38!=t.keyCode&&87!=t.keyCode||(this.forward=!1),40!=t.keyCode&&83!=t.keyCode||(this.backward=!1),this.run=t.shiftKey},t.prototype.bindevents=function(t,s){var i=this;t.addEventListener("keydown",function(t){return i.keydown(t)},!1),t.addEventListener("keyup",function(t){return i.keyup(t)},!1),t.addEventListener("pointerlockchange",function(e){i.lockChangeAlert(t,s)},!1),t.addEventListener("mozpointerlockchange",function(e){i.lockChangeAlert(t,s)},!1),s.addEventListener("touchstart",function(t){i.touchstart(t)},!1),s.addEventListener("touchend",function(t){i.touchend(t)},!1),s.addEventListener("click",function(t){s.requestPointerLock=s.requestPointerLock||s.mozRequestPointerLock,s.requestPointerLock(),i.shoot=!0},!1)},t.prototype.lockChangeAlert=function(t,s){var i=document.getElementById("gamecanvas");t.pointerLockElement===i||document.mozPointerLockElement===s?t.addEventListener("mousemove",this.mousemovefunction,!1):t.removeEventListener("mousemove",this.mousemovefunction,!1)},t}();s.Controls=i},function(t,s,i){"use strict";var e=i(5),n=function(){function t(s){this.angle=t.normalizeangle(s),this.sin=Math.sin(s),this.cos=Math.cos(s),this.tg=this.sin/this.cos,this.ctg=this.cos/this.sin,this.dx=this.cos>0?1:0,this.dy=this.sin>0?1:0}return t.normalizeangle=function(t){return t<0&&(t+=e.PI2_0),t>e.PI2_0&&(t-=e.PI2_0),t},t}();s.Angle=n},function(t,s){"use strict";var i=function(){function t(t,s){this.map=new Uint8Array(t*t),this.size=t,this.randomize(s)}return t.prototype.setvalue=function(t,s,i){var e=this.size*s+t;e<this.map.length&&e>=0&&(this.map[this.size*s+t]=i)},t.prototype.getvalue=function(t,s){if(t>=0&&s>=0&&t<this.size&&s<this.size){var i=this.size*s+t;return this.map[i]}return 0},t.prototype.randomize=function(t){for(var s=0;s<this.map.length;s++)Math.random()<t?Math.random()<.1?this.map[s]=5:Math.random()<.1?this.map[s]=4:Math.random()<.3?this.map[s]=3:Math.random()<.5?this.map[s]=2:this.map[s]=1:this.map[s]=0},t}();s.Map=i},function(t,s,i){"use strict";var e=i(13),n=i(5),o=i(10),a=function(){function t(t,s,i,n){this.position=t,this.facing=s,this.fov=i,this.loader=n,this.mixer=new e.Mixer(n)}return t.prototype.getrays=function(t){for(var s=this.fov/t,i=this.facing.angle+this.fov/2,e=new Array,n=0;n<t;n++)e.push(new o.Angle(i)),i-=s;return e},t.prototype.shoot=function(){this.mixer.playsound(0)},t.prototype.rotateleft=function(t,s){this.facing=new o.Angle(this.facing.angle+Math.PI*s*t/1200)},t.prototype.rotateright=function(t,s){this.facing=new o.Angle(this.facing.angle-Math.PI*s*t/1200)},t.prototype.correctposition=function(t,s){return t.getvalue(Math.floor(s.x),Math.floor(this.position.y))>0&&(s.x=this.position.x),t.getvalue(Math.floor(this.position.x),Math.floor(s.y))>0&&(s.y=this.position.y),s},t.prototype.moveforward=function(t,s,i){var e={x:this.position.x+this.facing.cos*t/(i?250:500),y:this.position.y+this.facing.sin*t/(i?250:500)};this.position=this.correctposition(s,e)},t.prototype.movebackward=function(t,s){var i={x:this.position.x-this.facing.cos*t/500,y:this.position.y-this.facing.sin*t/500};this.position=this.correctposition(s,i)},t.prototype.strafeleft=function(t,s,i){var e=new o.Angle(this.facing.angle-n.PI0_5),a={x:this.position.x+e.cos*t/(i?250:500),y:this.position.y+e.sin*t/(i?250:500)};this.position=this.correctposition(s,a)},t.prototype.straferight=function(t,s,i){var e=new o.Angle(this.facing.angle+n.PI0_5),a={x:this.position.x+e.cos*t/(i?250:500),y:this.position.y+e.sin*t/(i?250:500)};this.position=this.correctposition(s,a)},t.prototype.initonmap=function(t){for(;t.getvalue(Math.floor(this.position.x),Math.floor(this.position.y))>0;)this.position.x+=1},t.prototype.getcontrols=function(t,s,i){t.forward&&this.moveforward(i,s,t.run),t.backward&&this.movebackward(i,s),t.rotateleft&&this.rotateleft(i,1),t.rotateright&&this.rotateright(i,1),t.mouserotateleft&&this.rotateleft(i,t.mouserotateleft),t.mouserotateright&&this.rotateright(i,t.mouserotateright),t.strafeleft&&this.strafeleft(i,s,t.run),t.straferight&&this.straferight(i,s,t.run),t.shoot&&(this.shoot(),t.shoot=!1),t.resetmouserotate()},t}();s.Player=a},function(t,s){"use strict";var i=function(){function t(t){this.maxchannels=32,this.loader=t,this.audiochannels=new Array;for(var s=0;s<this.maxchannels;s++)this.audiochannels[s]=new e,this.audiochannels[s].audioel=new Audio,this.audiochannels[s].finish=-1}return t.prototype.playsound=function(t){for(var s=0;s<this.audiochannels.length;s++){var i=new Date,e=i.getTime();if(console.log(this.loader.sounds[t].duration),this.audiochannels[s].finish<e){this.audiochannels[s].finish=e+1e3*this.loader.sounds[t].duration,this.audiochannels[s].audioel.src=this.loader.sounds[t].src,this.audiochannels[s].audioel.play();break}}},t}();s.Mixer=i;var e=function(){function t(){}return t}()},function(t,s){}]);
//# sourceMappingURL=app.bundle.js.map